<!DOCTYPE html>
<html>
    <head>
        <title>Wishing Fish Clock</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body id="body">
        <!-- Clock flagrantly stolen from http://bl.ocks.org/tomgp/6475678 -->
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <div class="container">
            <h1>Wishing Fish Clock</h1>
            <svg id="clock" fill="none" fill-rule="evenodd" stroke="black" stroke-width="0.501" stroke-linejoin="bevel" stroke-miterlimit="10" font-family="Times New Roman" font-size="16" style="font-variant-ligatures:none" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" version="1.1" overflow="visible" width=900 height=700 viewBox="241.74 -593.726 111.796 172.53">
                <defs>
                 <radialGradient id="RadialGradient" gradientUnits="userSpaceOnUse" cx="298.286" cy="424.532" r="2.907" gradientTransform="matrix(-0.664093 -0.74765 0.74765 -0.664093 -119.421 504.172)">
                  <stop offset="0" stop-color="#b67c50"/>
                  <stop offset="1" stop-color="#854f26"/>
                 </radialGradient>
                </defs>
                <g id="clock" transform="scale(1 -1)">
                 <path d="M 245.055,483.594 L 297.661,482.158 L 350.268,483.594 C 336.022,471.146 316.533,458.845 316.483,435.76 L 278.84,435.76 C 278.79,458.845 259.301,471.146 245.055,483.594 Z" stroke="none" fill="#854f26" stroke-linejoin="miter" marker-start="none" marker-end="none"/>
                 <rect x="-5.643" y="-44.61" width="11.286" height="89.221" transform="translate(247.385 537.829) rotate(180)" fill="#985d30" stroke="none" stroke-linejoin="miter"/>
                 <rect x="-5.643" y="-44.61" width="11.286" height="89.221" transform="translate(347.892 537.829) rotate(180)" fill="#985d30" stroke="none" stroke-linejoin="miter"/>
                 <rect x="253.029" y="582.44" width="89.221" height="11.286" fill="#c89268" stroke="none" stroke-linejoin="miter"/>
                 <rect x="253.029" y="481.932" width="89.221" height="11.286" fill="#854f26" stroke="none" stroke-linejoin="miter"/>
                 <rect x="253.029" y="493.219" width="89.221" height="89.221" fill="#a36c42" stroke="none" stroke-linejoin="miter"/>
                 <ellipse rx="53.48" ry="53.48" transform="translate(297.639 537.829) rotate(90)" fill="#985d30" stroke-linejoin="round" stroke-linecap="round" stroke-width="0.561" stroke="none"/>
                 <ellipse rx="52.08" ry="52.08" transform="translate(297.639 537.829) rotate(90)" fill="#47a8a9" stroke-linejoin="round" stroke-linecap="round" stroke-width="0.547" stroke="none"/>
                 <ellipse rx="37.88" ry="37.88" transform="translate(297.639 537.829) rotate(90)" fill="#985d30" stroke-linejoin="round" stroke-linecap="round" stroke-width="0.397" stroke="none"/>
                 <ellipse rx="36.005" ry="36.005" transform="translate(297.639 537.829) rotate(90)" fill="#110200" stroke-linejoin="round" stroke-linecap="round" stroke-width="0.377" stroke="none"/>
                 <ellipse rx="33.755" ry="33.755" transform="translate(297.639 537.829) rotate(90)" fill="#a8956a" stroke-linejoin="round" stroke-linecap="round" stroke-width="0.353" stroke="none"/>
                 <ellipse rx="32.93" ry="32.93" transform="translate(297.639 537.829) rotate(90)" fill="#1a4988" stroke-linejoin="round" stroke-linecap="round" stroke-width="0.345" stroke="none"/>
                 <g id="clock-face" transform="translate(297.639 537.829) scale(1 -1)"></g>
                 <path d="M 241.741,493.218 L 253.028,493.218 L 253.028,481.931 L 245.055,483.594 L 241.741,493.218 Z" fill="#8f5325" stroke="none" stroke-linejoin="miter" marker-start="none" marker-end="none"/>
                 <path d="M 353.535,493.218 L 342.248,493.218 L 342.248,481.931 L 350.221,483.594 L 353.535,493.218 Z" fill="#8f5325" stroke="none" stroke-linejoin="miter" marker-start="none" marker-end="none"/>
                 <path d="M 353.536,582.438 L 342.249,582.438 L 342.249,593.725 L 350.222,592.062 L 353.536,582.438 Z" fill="#b67c50" stroke="none" stroke-linejoin="miter" marker-start="none" marker-end="none"/>
                 <path d="M 241.74,582.439 L 253.027,582.439 L 253.027,593.726 L 245.054,592.063 L 241.74,582.439 Z" fill="#b67c50" stroke="none" stroke-linejoin="miter" marker-start="none" marker-end="none"/>
                 <path d="M 253.024,481.931 L 342.248,481.931 C 328.002,469.483 316.482,458.845 316.432,435.76 L 278.84,435.76 C 278.79,458.845 267.27,469.483 253.024,481.931 Z" stroke="none" fill="#985d30" stroke-linejoin="miter" marker-start="none" marker-end="none"/>
                 <rect x="275.988" y="433.621" width="43.296" height="2.139" fill="#985d30" stroke="none" stroke-linejoin="miter"/>
                 <rect x="278.687" y="431.482" width="37.898" height="2.139" fill="#854f26" stroke="none" stroke-linejoin="miter"/>
                 <rect x="277.712" y="429.343" width="39.849" height="2.139" fill="#985d30" stroke="none" stroke-linejoin="miter"/>
                 <rect x="278.687" y="427.204" width="37.898" height="2.139" fill="#854f26" stroke="none" stroke-linejoin="miter"/>
                 <ellipse rx="2.907" ry="2.907" transform="translate(297.638 424.103) rotate(131.612)" stroke="none" stroke-linejoin="miter" fill="url(#RadialGradient)"/>
                </g>
               </svg>

            <script>
                const radians = 0.0174532925,
                    clockRadius = 55,
                    margin = 0,
                    width = (clockRadius+margin)*2,
                    height = (clockRadius+margin)*2,
                    hourHandLength = 2 * clockRadius / 5 + 3,
                    minuteHandLength = clockRadius - 17,
                    secondHandLength = clockRadius - 20,
                    secondHandBalance = 10,
                    secondTickStart = clockRadius;
                    secondTickLength = -10,
                    hourTickStart = clockRadius,
                    hourTickLength = -18
                    secondLabelRadius = clockRadius + 16;
                    secondLabelYOffset = 5
                    hourLabelRadius = clockRadius - 10
                    hourLabelYOffset = 4;

                const hourScale = d3.scale.linear()
                    .range([0,330])
                    .domain([0,11]);
                
                const minuteScale = secondScale = d3.scale.linear()
                    .range([0,354])
                    .domain([0,59]);
                
                let handData = [
                    {
                        type:'hour',
                        value:0,
                        length:-hourHandLength,
                        scale:hourScale
                    },
                    {
                        type:'minute',
                        value:0,
                        length:-minuteHandLength,
                        scale:minuteScale
                    },
                    {
                        type:'second',
                        value:0,
                        length:-secondHandLength,
                        scale:secondScale,
                        balance:secondHandBalance
                    }
                ];
                
                const sunrise = d3.interpolate("#68c2d8", "#021b2f");

                function drawClock(){ //create all the clock elements
                    updateData();	//draw them in the correct starting position
                    var face = d3.select("#clock-face");

                    face.selectAll('.hour-label')
                        .data(d3.range(1,13))
                            .enter()
                            .append('text')
                            .attr('class', 'hour-label')
                            .attr('text-anchor','middle')
                            .attr('x',function(d){
                                return hourLabelRadius*Math.sin(hourScale(d)*radians);
                            })
                            .attr('y',function(d){
                                return -hourLabelRadius*Math.cos(hourScale(d)*radians) + hourLabelYOffset;
                            })
                            .text(function(d){
                                return d;
                            });
                
                
                    var hands = face.append('g').attr('id','clock-hands');
                
                    face.append('g').attr('id','face-overlay')
                        .append('circle').attr('class','hands-cover')
                            .attr('x',0)
                            .attr('y',0)
                            .attr('r',clockRadius/20);
                
                    hands.selectAll('line')
                        .data(handData)
                            .enter()
                            .append('line')
                            .attr('class', function(d){
                                return d.type + '-hand';
                            })
                            .attr('x1',0)
                            .attr('y1',function(d){
                                return d.balance ? d.balance : 0;
                            })
                            .attr('x2',0)
                            .attr('y2',function(d){
                                return d.length;
                            })
                            .attr('transform',function(d){
                                return 'rotate('+ d.scale(d.value) +')';
                            });
                }
                
                function moveHands(){
                    d3.select('#clock-hands').selectAll('line')
                    .data(handData)
                        .transition()
                        .attr('transform',function(d){
                            return 'rotate('+ d.scale(d.value) +')';
                        });
                }

                function advanceBackground() {
                    const t = new Date();
                    const hrs = Math.abs(t.getSeconds() - 30) / 30;
                    d3.select("#body")
                        .transition()
                        .duration(1000)
                        .style("background", sunrise(hrs));
                }
                
                function updateData(){
                    var t = new Date();
                    handData[0].value = (t.getHours() % 12) + t.getMinutes()/60 ;
                    handData[1].value = t.getMinutes();
                    handData[2].value = t.getSeconds();
                }
                
                drawClock();
                advanceBackground();
                
                setInterval(function(){
                    updateData();
                    moveHands();
                    advanceBackground();
                }, 1000);
                
                d3.select(self.frameElement).style("height", height + "px");
                </script>
        </div>
    </body>
</html>
